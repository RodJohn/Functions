

# 用户部分

## 功能描述

## 1. 用户来源  

    是否仅有企业内部用户,
    是否有外部用户,
    是否需要按照组织架构显示
    需要企业内部用户接口,
    和相应的触发更新
## 5 api 

    查询用户
    
    双向修改    
    
## 3. 用户识别

    由apigateway给出    

## 表结构

### 用户表结构(t_im_user)

    user_id     用户id    
    status      状态  
    name        用户名
    head_icon   头像    (用户名,头像也可以考虑不要 )  


    
    
# 聊天

## 功能描述

### 点对点聊天+群聊

   点对点聊天通过加人可以升级为群聊

### 多种数据形式

    可发送的数据类型:文字,表情,图片,文件
    图片.附件只能单独单个发送
    文字和表情之间可以混排
    表情使用特别前缀后缀识别
    
### 推送消息状态

    消息状态:未接受/已接收/已读

### 会话列表

显示方式

   按是否存在未读消息和最后聊天时间倒序
   显示 聊天名 用户名 聊天图像  未读消息数量 最后一条消息  最后聊天时间

用户重新登录时,查询该会话列表


### 消息查询

聊天记录翻页查询
    
    一个月内的数据存本地关系数据库
    超过一个月的数据,从本地物理删除,存在es中
    
    es中数据结构

search contact 

    按照内容+用户查询      
       
## 问题

### 消息时序性

    server_time
    
### 批量删除

    定时删除--空洞    
           

## 表设计


### 聊天频道信息表 (t_im_channel)

    channel_id        频道id
    channel_name      频道名称
    channel_type      频道类型  (群聊/非群聊  冗余)
    creator           创建人id
    create_time       创建时间
    owner             管理员
    announcement      频道公告
    
    
### 聊天室用户表   (t_im_channel_user)
   
    channel_id      频道id
    user_id         用户id
    role            用户角色(管理员/非管理员 冗余)    
    
### 消息表 (t_im_message)

    ms_id           消息id
    channel_id      频道id
    server_time     服务器接受时间
    sender          发送人id  
    ms_type         消息类型(文字/表情 /图片//附件)  (可不要)   
    content         消息正文  


### 消息推送表 (t_im_message_push)


    ms_id               消息id
    channel_id          频道id
    receiver            接受人id
    status              状态(未接受/已接收/已读  )  
    last_modified_time  最后修改时间    


### 表情识别表 (t_im_emoji)  

    emoji_id    表情id
    address     地址(key或者url)

